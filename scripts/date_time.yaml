shutoff:
  alias: Shutoff All
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.bedroom
        brightness: 0
        transition: 15
    - delay:
        seconds:
          15
    - service: homeassistant.turn_off
      entity_id: group.a_lights
    - service: media_player.turn_off
      entity_id: media_player.denon_avrx1300w
    - service: media_player.turn_off
      entity_id: media_player.vizio_smartcast
    - service: media_player.turn_off
      entity_id: media_player.home_audio
    - service: media_player.media_stop
      entity_id: media_player.mpd
    - service: switch.turn_off
      entity_id: switch.justins_pc
    - service: lock.lock
      entity_id: lock.front_door
    - service: switch.turn_off
      entity_id: switch.led_strip_switch
    - condition: template
      value_template: '{{ bedtime == false }}'
    - service: switch.turn_off
      entity_id: switch.bedroom_fan
    - service: switch.turn_off
      entity_id: switch.bedroom_air_purifier
morning:
  alias: Morning
  sequence:
    - service: script.turn_on
      entity_id: script.ringer_on_conditional
    - condition: or
      conditions:
        - condition: state
          entity_id: binary_sensor.justin_presence
          state: 'on'
        - condition: state
          entity_id: binary_sensor.jenni_presence
          state: 'on'
    - service: switch.turn_on
      entity_id: switch.justins_pc
    - service: script.turn_on
      entity_id: script.switch_to_audio
    - condition: or
      conditions:
        - condition: and
          conditions:
            - condition: time
              weekday:
                - mon
                - tue
                - wed
                - thu
                - fri
            - condition: state
              entity_id: input_boolean.weekday_alarm
              state: 'on'
        - condition: and
          conditions:
            - condition: time
              weekday:
                - sat
                - sun
            - condition: state
              entity_id: input_boolean.weekend_alarm
              state: 'on'
    - delay:
        minutes: 5
    - service: script.turn_on
      entity_id: script.morning_music
    - wait_template: '{{ is_state("automation.music_started_1", "off") }}'
      timeout: '00:05:00'
    - wait_template: '{{ is_state("automation.music_started_1", "on") }}'
      timeout: '00:20:00'
    - service: light.turn_on
      data:
        entity_id: light.bedroom
        brightness: 0
    - delay:
        seconds: 1
    - service: light.turn_on
      data:
        entity_id: light.bedroom
        brightness_pct: 80
        transition: 300
    - delay:
        minutes: 20
    - service: script.turn_on
      entity_id: script.fade_in_music
      data:
        variables:
          step_size: -0.05
          stop_volume: 0
    - wait_template: '{{ states("input_number.living_room_audio_volume")|float == 0 }}'
      timeout: '00:10:00'
    - service: script.turn_on
      entity_id: script.play_all_music
    - service: script.turn_on
      entity_id: script.fade_in_music
      data:
        variables:
          step_size: 0.05
          stop_volume: 0.8
    - wait_template: '{{ states("input_number.living_room_audio_volume")|float == 0.8 }}'
      timeout: '00:10:00'
    - delay:
        minutes: 5
    - service: light.turn_on
      data:
        entity_id: light.bedroom
        brightness_pct: 100
    - service: switch.turn_on
      entity_id: switch.phone_ringer_on
    - service: lock.unlock
      entity_id: lock.front_door
    - service: light.turn_on
      entity_id: light.kitchen
ringer_on_conditional:
  alias: Phone Ringer On Conditional
  sequence:
    - condition: state
      entity_id: binary_sensor.justin_presence
      state: 'on'
    - service: switch.turn_on
      entity_id: switch.phone_ringer_on
sunset:
  alias: Sunset
  sequence:
    - service: light.turn_on
      entity_id: light.fairy_lights
    - service: light.turn_on
      entity_id: light.living_room_lamp
    - service: switch.turn_on
      entity_id: switch.christmas_wreath
    - service: script.turn_on
      entity_id: script.led_strip_turn_on
bedtime:
  alias: Bedtime
  sequence:
    - service: script.turn_on
      entity_id: script.shutoff
      data:
        variables:
          bedtime: true
    - service: switch.turn_off
      entity_id: switch.christmas_wreath
    - service: switch.turn_on
      entity_id: switch.phone_bedtime
    - service: script.turn_on
      entity_id: script.forgot_to_feed_fish
    - service: input_boolean.turn_off
      entity_id: input_boolean.fish_fed_tracker
    - service: script.turn_on
      entity_id: script.forgot_to_water_the_plants
    - service: input_boolean.turn_off
      entity_id: input_boolean.plants_watered_tracker
    - service: switch.turn_on
      data_template:
        entity_id: >
          {% if states('sensor.dark_sky_daytime_high_apparent_temperature')|int > 18 %}
            switch.bedroom_fan
          {% else %}
            switch.bedroom_air_purifier
          {% endif %}
    - service: switch.turn_off
      data_template:
        entity_id: >
          {% if states('sensor.dark_sky_daytime_high_apparent_temperature')|int > 18 %}
            switch.bedroom_air_purifier
          {% else %}
            switch.bedroom_fan
          {% endif %}
    - delay:
        minutes: 30
    - service: shell_command.shutdown