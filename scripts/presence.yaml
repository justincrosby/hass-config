arrive_home:
  alias: Arrive Home
  sequence:
    - condition: state
      entity_id: binary_sensor.presence_everyone_home
      state: 'off'
#    - service: lock.unlock
#      entity_id: lock.front_door
    - service: script.turn_on
      entity_id: script.turn_on_pc_conditional
    - service: switch.turn_on
      entity_id: switch.led_strip_switch
    # disable these automations so they don't mess with audio settings
    - service: automation.turn_off
      entity_id: automation.music_started_1
    - service: automation.turn_off
      entity_id: automation.music_started_2
    - service: automation.turn_off
      entity_id: automation.media_input_select_changed
    - service: automation.turn_off
      entity_id: automation.chromecast_volume_slider_moved
    - delay:
        seconds: 1
    - service: script.turn_on
      entity_id: script.play_all_music_conditional
    - delay:
        seconds: 1
    - service: script.turn_on
      entity_id: script.fade_in_music
      data:
        variables:
          step_size: 5
          start_volume: 0
          stop_volume: !secret default_home_audio_volume
#    - service: light.turn_on
#      data_template:
#        entity_id: light.kitchen
#        brightness_pct: >
#            {% if now().strftime("%H")|int > 23 %}
#              30
#            {% else %}
#              95
#            {% endif %}
    - condition: sun
      after: sunset
      after_offset: "+00:20:00"
    - service: script.turn_on
      entity_id: script.sunset
turn_on_pc_conditional:
  alias: Turn On the PC In the Evening
  sequence:
    - condition: time
      after: "17:00:00"
    - service: switch.turn_on
      entity_id: switch.justins_pc
arrive_home_justin:
  alias: Arrive Home Justin
  sequence:
    - service: switch.turn_on
      entity_id: switch.phone_ringer_on
    - condition: or
      conditions:
        - condition: time
          after: "23:30:00"
        - condition: time
          before: "04:00:00"
    - service: switch.turn_on
      entity_id: switch.phone_bedtime
leave_home:
  alias: Leave Home
  sequence:
    - condition: state
      entity_id: binary_sensor.presence_anyone_home
      state: 'off'
    - service: script.turn_on
      entity_id: script.shutoff
      data:
        variables:
          bedtime: false
leave_home_justin:
  alias: Leave Home Justin
  sequence:
    - service: switch.turn_on
      entity_id: switch.phone_ringer_off
be_right_back:
  alias: Be Right Back
  sequence:
    - service: script.turn_on
      entity_id: script.disable_presence
    - delay:
        minutes: 15
    - service: script.turn_on
      entity_id: script.enable_presence
disable_presence:
  alias: Disable Presence
  sequence:
    - service: automation.turn_off
      entity_id: automation.arrive_home_jenni
    - service: automation.turn_off
      entity_id: automation.arrive_home_justin
    - service: automation.turn_off
      entity_id: automation.leave_home_jenni
    - service: automation.turn_off
      entity_id: automation.leave_home_justin
enable_presence:
  alias: Enable Presence
  sequence:
    - service: automation.turn_on
      entity_id: automation.arrive_home_jenni
    - service: automation.turn_on
      entity_id: automation.arrive_home_justin
    - service: automation.turn_on
      entity_id: automation.leave_home_jenni
    - service: automation.turn_on
      entity_id: automation.leave_home_justin
enable_presence_on_boot:
  alias: Enable Presence on Boot After Some Time
  sequence:
    - delay:
        minutes: 5
    - service: script.turn_on
      entity_id: script.enable_presence