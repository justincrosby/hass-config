# Home Assistant YAML Style Guide - Copilot Instructions

These instructions ensure all YAML code follows the Home Assistant official style guide.

## Core Formatting Rules

### Indentation
- Use exactly 2 spaces for indentation (never tabs)
- Increase indentation by 2 spaces per nesting level
- Match comment indentation to the current indentation level

### Booleans
- Use only lowercase `true` and `false` for YAML boolean values
- Never use truthy values: `yes`, `no`, `y`, `n`, `True`, `False`
- **IMPORTANT**: Entity states are STRINGS, not booleans. When checking state conditions:
  - Use `state: "on"` or `state: "off"` (quoted strings)
  - NOT `state: true` or `state: false`
  - Examples:
    - ✅ `state: "on"` for binary sensor or switch states
    - ❌ `state: true` for entity state checks
    - ✅ `state: false` for unquoted entity attribute values or data parameters
    - ✅ `brightness_pct: 80` for numeric data (not a state)

### Null Values
- Use implicit null (empty value)
- Avoid explicit null markers: `~` or `null`

### Comments
- Start comments with a capital letter
- Place comments above the line they describe (preferred) or inline
- Use exactly one space between `#` and comment text
- Match comment indentation to surrounding code

## String Handling

### General String Rules
- Prefer double quotes (`"`) for all regular strings
- Avoid unquoted strings
- Description strings in script fields must be double-quoted

### Home Assistant String Exemptions (unquoted)
Do NOT quote these special Home Assistant values:
- Entity IDs: `light.living_room`, `sensor.temperature`
- Entity attributes: `temperature`, `brightness`
- Device IDs, Area IDs, Platform types: `light`, `switch`
- Condition types: `state`, `numeric_state`, `template`
- Trigger types: `state`, `time`, `event`
- Action names: `light.turn_on`, `notify.send`
- Device classes: `motion`, `problem`, `temperature`
- Event names and fixed enumeration values

### Multi-line Strings
- Use literal style (`|`) to preserve newlines
- Use folded style (`>`) to remove newlines between lines
- Use chomp operators:
  - No operator `|` or `>`: Default (single trailing newline)
  - Strip operator `|-` or `>-`: Remove trailing newlines
  - Keep operator `|+` or `>+`: Preserve all trailing newlines
- Avoid `\n` escape sequences when multi-line strings can be used

### Template Strings
- Double-quote templates and use single quotes inside: `"{{ 'value' == entity_id }}"`
- Never single-quote templates with double quotes inside
- Add spaces around filter pipes: `"{{ value | float }}"`
- Use parentheses for clarity with chained filters: `"{{ (value | float) < 10 }}"`
- Use helper functions instead of direct state access:
  - Good: `states('sensor.temperature')`, `state_attr('climate.living_room', 'temperature')`
  - Bad: `states.sensor.temperature.state`, `states.climate.living_room.attributes.temperature`
- Split long templates across multiple lines using folded style (`>`)
- Avoid templates if pure YAML alternatives exist

## Collections

### Sequences (Lists)
- Use block style (preferred) - each item on its own line with `-`
- Avoid flow style (`[item1, item2]`)
- If flow style must be used:
  - No spaces before opening/closing brackets: `[1, 2, 3]`
  - Space after each comma: `[1, 2, 3]` not `[1,2,3]`
  - Never use flow style for long lists or entity IDs

### Mappings (Key-Value Pairs)
- Use only block style mappings
- Never use flow style (`{key: value}`) that looks like JSON
- Proper indentation with 2-space increases

### Scalar Properties Accepting Single or Multiple Values
- Use single scalar value when appropriate: `entity_id: light.living_room`
- Use block-style list for multiple values:
  ```yaml
  entity_id:
    - light.living_room
    - light.office
  ```
- Never use comma-separated strings: `entity_id: light.living_room, light.office`
- Never use single-item lists: don't use `[light.living_room]`

### Mappings Accepting Single or Multiple Items
- Always use list format, even for single item (for consistency and extensibility):
  ```yaml
  # Good
  actions:
    - action: light.turn_on
      target:
        entity_id: light.living_room
  ```
- Never use direct mapping for single items

## Home Assistant Specific Rules

### Service Action Targets (Preferred Method)
- Use `target:` with `entity_id`, `area_id`, `device_id` (modern approach)
- Avoid `entity_id:` at action level
- Avoid passing `entity_id` in `data:`

```yaml
# Good
actions:
  - action: light.turn_on
    target:
      entity_id: light.living_room
  - action: light.turn_on
    target:
      area_id: living_room
```

### Default Values
- Omit options with default values from examples
- Only include defaults when specifically educating about that option
- Example: Don't include `condition: []` if it's the default

### Condition Syntax
- Prefer shorthand template syntax when available
- Use `"{{ condition_expression }}"` over verbose condition blocks

## Complete YAML Example

```yaml
# Good automation example
alias: "Motion detected notification"
description: "Send notification when motion is detected"

triggers:
  - trigger: state
    entity_id: binary_sensor.motion_sensor
    to: "on"

conditions:
  - condition: state
    entity_id: light.living_room
    state: "off"

actions:
  - action: notify.send
    data:
      title: "Motion Alert"
      message: "Motion detected in living room"
  - action: light.turn_on
    target:
      entity_id: light.living_room
    data:
      brightness: 255
      transition: 2
```

## Quick Checklist

- [ ] 2-space indentation throughout
- [ ] Booleans are lowercase `true`/`false` only
- [ ] Strings are double-quoted (except Home Assistant exemptions)
- [ ] No flow-style sequences or mappings (JSON-style)
- [ ] Block-style lists for multiple items
- [ ] Comments above lines, not inline (preferred)
- [ ] No default values unless necessary
- [ ] Service actions use `target:` not `entity_id:`
- [ ] Helper functions for templates (`states()`, `state_attr()`)
- [ ] Long templates split across lines with `>`
