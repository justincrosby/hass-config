- alias: Music Started 1
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.media_source
    to: 'CastAudio'
  action:
    - service: script.turn_on
      entity_id: script.switch_to_audio

- alias: Music Started 2
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.media_status
    to: 'playing'
  action:
    - service: script.turn_on
      entity_id: script.switch_to_audio

- alias: Music Started 3
  initial_state: on
  trigger:
    platform: state
    entity_id: media_player.home_audio
    to: 'playing'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.media_output_select
        option: 'Home Audio'

- alias: Music Started 4
  initial_state: on
  trigger:
    platform: state
    entity_id: media_player.fake_home_audio
    to: 'playing'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.media_output_select
        option: 'Fake Home Audio'

- alias: Music Started 5
  initial_state: on
  trigger:
    platform: state
    entity_id: media_player.master_suite_audio
    to: 'playing'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.media_output_select
        option: 'Master Suite Audio'

- alias: Casting Started 1
  trigger:
    platform: state
    entity_id: media_player.vizio_smartcast
    to: 'on'
  action:
    - service: script.turn_on
      entity_id: script.switch_to_chromecast

- alias: Casting Started 2
  trigger:
    platform: state
    entity_id: media_player.vizio_smartcast
    to: 'playing'
  action:
    - service: script.turn_on
      entity_id: script.switch_to_chromecast

- alias: Casting Started 3
  trigger:
    platform: state
    entity_id: media_player.bedroom_tv
    to: 'playing'
  action:
    - service: media_player.turn_off
      data_template:
        entity_id: '{{ states("sensor.media_output") }}'
    - service: media_player.turn_off
      entity_id: media_player.mpd

- alias: Cast music when playing from MPD
  trigger:
    platform: state
    entity_id: media_player.mpd
    from: 'off'
    to: 'playing'
  action:
    - service: script.turn_on
      entity_id: script.stream_mopidy_to_cc

- alias: Restart stream
  trigger:
    platform: state
    entity_id: sensor.media_status
    from: 'playing'
    to: 'idle'
  action:
    - service: script.turn_on
      entity_id: script.restart_mopidy_stream

- alias: Stop MPD when other device casting
  trigger:
    platform: state
    entity_id: sensor.home_audio_app
    to: 'Spotify'
  action:
    - service: media_player.media_stop
      entity_id: media_player.mpd

- alias: Home audio unavailable for 15 minutes
  trigger:
    platform: state
    entity_id: sensor.media_status
    to: 'unavailable'
    for:
      minutes: 15
  action:
    service: homeassistant.restart

- alias: Living Room Audio Slider Moved
  trigger:
    platform: state
    entity_id: input_number.living_room_audio_volume
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_audio
      volume_level: '{{ states("input_number.living_room_audio_volume")|float }}'

- alias: Bedroom Audio Slider Moved
  trigger:
    platform: state
    entity_id: input_number.bedroom_audio_volume
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.bedroom_audio
      volume_level: '{{ states("input_number.bedroom_audio_volume")|float }}'

- alias: Bathroom Audio Slider Moved
  trigger:
    platform: state
    entity_id: input_number.bathroom_audio_volume
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.bathroom_speaker
      volume_level: '{{ states("input_number.bathroom_audio_volume")|float }}'

- alias: Main Bathroom Audio Slider Moved
  trigger:
    platform: state
    entity_id: input_number.main_bathroom_audio_volume
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.main_bathroom_speaker
      volume_level: '{{ states("input_number.main_bathroom_audio_volume")|float }}'

- alias: Media Input Select Changed
  initial_state: on
  trigger:
    platform: state
    entity_id: input_select.media_select
  action:
    service: script.turn_on
    entity_id: script.media_input_select

- alias: Receiver Volume Slider Moved
  trigger:
    platform: state
    entity_id: input_number.receiver_audio_volume
  # Prevent recursive calls
  condition:
    condition: template
    value_template: '{{ states("sensor.receiver_volume") != states("input_number.receiver_audio_volume") }}'
  action:
    service: script.turn_on
    entity_id: script.receiver_volume_changed

- alias: Receiver Volume Changed
  trigger:
    platform: state
    entity_id: sensor.receiver_volume
  # Prevent recursive calls
  condition:
    condition: template
    value_template: '{{ states("sensor.receiver_volume") != states("input_number.receiver_audio_volume") }}'
  action:
    - service: script.turn_on
      entity_id: script.update_receiver_volume_slider

- alias: Chromecast Volume Slider Moved
  trigger:
    platform: state
    entity_id: input_number.chromecast_audio_volume
  # Prevent recursive calls
  condition:
    condition: template
    value_template: '{{ states("sensor.chromecast_volume") != states("input_number.chromecast_audio_volume") }}'
  action:
    service: script.turn_on
    entity_id: script.chromecast_volume_changed

- alias: Chromecast Volume Changed
  trigger:
    platform: state
    entity_id: sensor.chromecast_volume
  # Prevent recursive calls
  condition:
    condition: template
    value_template: '{{ states("sensor.chromecast_volume") != states("input_number.chromecast_audio_volume") }}'
  action:
    - service: script.turn_on
      entity_id: script.update_chromecast_volume_slider

- alias: Media Source Changed
  trigger:
    platform: state
    entity_id: sensor.media_source
  # Prevent recursive calls
  condition:
    condition: template
    value_template: '{{ states("sensor.media_source") != states("input_select.media_select") }}'
  action:
    - service: script.turn_on
      entity_id: script.update_media_select_source

- alias: Media Track Changed
  trigger:
    platform: state
    entity_id: sensor.media_track
  action:
    - service: shell_command.update_album_art

- alias: Media Output Changed
  trigger:
    platform: state
    entity_id: sensor.media_output
  action:
    - service: script.turn_on
      entity_id: script.stream_mopidy_to_cc